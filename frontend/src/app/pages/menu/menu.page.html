<ion-header [translucent]="true" class="menu-header">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <div class="header-logo">
        <ion-icon name="restaurant"></ion-icon>
        <span class="japanese-small">ÂØøÂè∏</span>
      </div>
    </ion-buttons>
    <ion-title class="header-title">Menu</ion-title>
    <ion-buttons slot="end">
      <ion-button class="cart-button" [class.cart-pulse]="cartPulse()" (click)="vaiCarrello()">
        <div class="cart-icon-wrapper">
          <ion-icon name="cart" class="cart-icon"></ion-icon>
          <div class="cart-badge" *ngIf="cartCount() > 0">{{ cartCount() }}</div>
        </div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  
  <ion-toolbar color="dark" class="category-toolbar">
    <ion-segment 
      [value]="selectedCategoria()" 
      (ionChange)="onCategoriaChange($event)"
      scrollable="true"
      class="category-segment"
      mode="md"
    >
      <ion-segment-button value="Tutte">
        <ion-label>üç± Tutte</ion-label>
      </ion-segment-button>
      <ion-segment-button *ngFor="let c of categorie()" [value]="c">
        <ion-label>{{ getCategoryIcon(c) }} {{ c }}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="menu-content">
  <div class="menu-container">
    <ng-container *ngFor="let group of gruppi()">
      <div class="category-section">
        <div class="category-header">
          <div class="category-line"></div>
          <h2 class="category-title">
            <span class="category-icon">{{ getCategoryIcon(group.categoria) }}</span>
            {{ group.categoria }}
          </h2>
          <div class="category-line"></div>
        </div>
        
        <div class="items-grid">
          <div *ngFor="let p of group.items" class="item-card">
            <div class="card-inner">
              <div class="card-image-container">
                <img 
                  *ngIf="p.immagine" 
                  [src]="p.immagine" 
                  [alt]="p.nome"
                  class="item-image"
                  loading="lazy"
                  (error)="onImageError(p)"
                />
                <div *ngIf="!p.immagine" class="placeholder-image">
                  <ion-icon name="restaurant-outline"></ion-icon>
                  <span>{{ p.nome.charAt(0) }}</span>
                </div>
                <div class="image-overlay"></div>
              </div>
              
              <div class="card-content">
                <h3 class="item-name">{{ p.nome }}</h3>
                <div class="item-footer">
                  <div class="item-price">
                    <span class="currency">‚Ç¨</span>
                    <span class="amount">{{ p.prezzo }}</span>
                  </div>
                  <button class="add-button" (click)="aggiungi(p)">
                    <ion-icon name="add"></ion-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
    
    <div class="spacer"></div>
  </div>

  <div class="floating-cart" *ngIf="cartCount() > 0">
    <ion-button 
      expand="block" 
      (click)="inviaOrdine()"
      class="submit-order-button"
    >
      <div class="button-content">
        <div class="button-icon">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
        <div class="button-text">
          <span class="button-label">Invia Ordine</span>
          <span class="button-count">{{ cartCount() }} {{ cartCount() === 1 ? 'prodotto' : 'prodotti' }}</span>
        </div>
        <div class="button-arrow">
          <ion-icon name="arrow-forward"></ion-icon>
        </div>
      </div>
    </ion-button>
  </div>
</ion-content>